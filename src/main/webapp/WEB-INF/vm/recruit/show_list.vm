#set($layout = "layout/recruit_layout.vm")
<style type="text/css">
    td input {
        width: 100%;
        text-align: center;
        color: red;
        font-size: larger;
    }

    td {
        text-align: center;
    }

</style>


<div class="row">
    <div class="col-xs-12">
        <div class="col-xs-7" style="float:right;width:100%;">
            <div class="form-group dash-button-group" style="margin-bottom: 0px; float: right;">
        <span class="input-icon input-icon-right">
           <select id="city_id">
                    <option value="">城市...</option>
                    <option value="北京">北京</option>
                    <option value="长春">长春</option>
                    <option value="哈尔滨">哈尔滨</option>
                    <option value="沈阳">沈阳</option>
                    <option value="大连">大连</option>
                    <option value="西安">西安</option>
                    <option value="武汉">武汉</option>
                    <option value="成都">成都</option>
                    <option value="南京">南京</option>
           </select>
        </span>
        <span class="input-icon input-icon-right">
            <input id="name" name="name" type="text" placeholder="姓名..." style="width: 100px"/>
        </span>
        <span class="input-icon input-icon-right">
            <input class="date" id="date-from" type="text" style="width: 186px" onclick="showTime()"
                   placeholder="开始日期..."/>
            <i class="icon-calendar green"></i>
        </span>
        <span class="input-icon input-icon-right">
            <input class="date" id="date-to" type="text" style="width: 186px" onclick="showTime()"
                   placeholder="开始日期..."/>
            <i class="icon-calendar green"></i>
        </span>
                <button id="search"
                        style="width: 60px; height:28px; font-size: 14px; margin: 0px 2px 4px; font-weight: bold"
                        class="btn btn-minier btn-primary">
                    查询
                </button>
            </div>
        </div>
    </div>
</div>
<div class="row">
	<div class="col-xs-12">
        <div class="col-xs-9" style="width:100%;">
            <div class="widget-box">
                <div class="widget-header header-color-blue" style="">
                    <h5 class="bigger lighter"><i class="icon-time"></i>面试官列表</h5>
                </div>
                <div class="widget-body">
                    <table id="apply_todo" class="table table-striped table-bordered table-hover">
                    
                    </table>
                </div>
            </div>

        </div>
	</div>
</div>
<div id="pageDiv">
    <table class='table '>
        <tr>
            <td colspan='9'>
                <span class='pagination'>合计 <span id="countofStaff"></span> 个用户每页显示</span>
                <select id='numofpage' class='input-small pagination '>
                    <option value='30'>30个</option>
                </select>

                <div class='pagination pull-right'>
                    <ul id='pageButton'></ul>
                </div>
            </td>
        </tr>
    </table>
</div>

<div id="common-notice-dialog" class="hide"></div>
<div id="apply-result-dialog" class="hide"></div>
<div id="back-msg-dialog" class="hide"></div>
<div id="del-msg-dialog" class="hide"></div>


<script src="static/js/utils.js">
</script>
<script src="static/js/dialog_common.js">
</script>
<script src="static/ace/js/jquery.dataTables.min.js">
</script>
<script src="static/ace/js/jquery.dataTables.bootstrap.js">
</script>
<script src="static/js/apply_common.js">
</script>
<script src="static/js/myJs.js">
</script>
<script src="static/js/all_common.js">
</script>
<script src="/recruit/static/My97DatePicker/WdatePicker.js"></script>
<script language=JavaScript>

    jQuery(function ($) {
        show_registered_staff("");
        $.ajax({
                    type: "GET",
                    contentType: 'application/json',
                    dataType: "json",
                    url: "/interview/getInterviewers",
                    data: {'pageIndex': 1, 'pageSize': 30},
                    success: function (returnedData) {
                    	alert(returnedData);
                        if( !ajaxReturn( returnedData ) ){
                            return;
                        }
                        if (returnedData == null) {
                            alert("系统中出现了异常，请稍后重试");
                            show_enrollState_empty_table();
                        }else {
                            show_registered_staff(returnedData);
                            if (returnedData.data != null) {
                                var count = parseInt(parseInt(returnedData.data.staffCount) / 30);
                                if (parseInt(parseInt(returnedData.data.staffCount) % 30) != 0) {
                                    count++;
                                }
                                setPage(document.getElementById("pageButton"), count, 1);//主要是添加系统中的分页的功能

                            }
                        }

                    },
                    error: function () {
                        alert("系统发生了错误请稍后重试");
                    }
                });
    });
    
    function showTime() {
        WdatePicker({dateFmt: 'yyyy-MM-dd'});
    }

    function show_registered_staff(returnedData) {
    	var table = "<table width='100%' style='table-layout:fixed' class='table table-bordered'><thead class='info'><tr><th style='width:20px;align:center;'><input type='checkbox' id='selectAll'  onclick='selectAllCheckBoxes(this);'></th><th style='width:60px;text-align:center;'>城市</th><th style='width:80px;text-align:center;'>姓名</th><th style='width:100px;text-align:center;'>用户名</th><th style='width:100px;text-align:center;'>密码</th><th style='width:90px;text-align:center;'>开始时间</th><th style='width:80px;text-align:center;'>结束时间</th><th style='width:200px;text-align:center;'>操作</th></tr></thead>";
		if (returnedData.data != null) {
            var staffInfos = returnedData.data.list;
            table = table + "<tbody>";
            for (var i = 0; i < (staffInfos.length); ++i) {
                table += "<tr><td><input type='checkbox' name='checked' value=" + (staffInfos[i].staffId) + " ></td>";
                table = table + "<td style='word-wrap:break-word;'>" + (staffInfos[i].staffId) + "</td>";
                table = table + "<td style='word-wrap:break-word;' id='name" + (staffInfos[i].staffId) + "'>" + (staffInfos[i].staffName) + "</td>";
                table = table + "<td style='word-wrap:break-word;'>" + (staffInfos[i].staffDepartment) + "</td>";
                table = table + "<td style='word-wrap:break-word;'>" + (staffInfos[i].staffEmail) + "</td>";
                table = table + "<td style='word-wrap:break-word;'>" + (staffInfos[i].staffPhone) + "</td>";
                table = table + "<td style='word-wrap:break-word;'>" + (staffInfos[i].staffNo) + "</td>";
                if ((staffInfos[i].remark) == null || (staffInfos[i].remark).length == 0) {
                    table = table + "<td style='word-wrap:break-all;' id='tdcomment" + (staffInfos[i].staffId) + "'>" + "<a href='#contentEdit' data-toggle='modal' class='btn btn-link' onclick=\"addComment(\' " + (staffInfos[i].staffId) + " \',\' " + (staffInfos[i].staffName) + "\')\">" + ((staffInfos[i].remark)) + "添加备注</a>" + "</td>";
                }
                else {
                    table = table + "<td style='word-wrap:break-all;' id='tdcomment" + (staffInfos[i].staffId) + "'>" +"<input type='hidden' id='remark"+(staffInfos[i].staffId) +"' value='"+(staffInfos[i].remark)+"'/>"+ "<span id=\"comment" + (staffInfos[i].staffId) + "\">" + (staffInfos[i].remark).substr(0,20)+"..." + "</span><a href='#contentEdit' data-toggle='modal' class='btn btn-link' onclick=\"addComment(\'" + (staffInfos[i].staffId) + "\',\'" + (staffInfos[i].staffName) + "\');\">" + "<i class='icon-edit'></i></a>" + "</td>";
                }
            }

        }
    	table += "</table>";
    	$("#apply_todo").html("");
    	$("#apply_todo").append(table);
	}
	
    //显示表格数据
    function showApplyTodoInfo(url, tableName, rTableId, status) {
        var ex = document.getElementById(tableName);
        if ($.fn.dataTable.fnIsDataTable(ex)) {
            $(ex).dataTable().fnDestroy();
        }

        var aoColumns = [
            {
                "sTitle": '<lable><input id="current-checkbox-select-all" ' +
                'type="checkbox" value="ALL" class="ace"><span class="lbl"></span></label>',
                "bSortable": false, "sWidth": 10, "sClass": "center"
            }, {
                "sTitle": "城市",
                "sWidth": 50,
                "sClass": "center",
                "bVisible": true
            }, {
                "sTitle": "姓名",
                "sWidth": 80,
                "sClass": "center"
            }, {
                "sTitle": "用户名",
                "sWidth": 80,
                "sClass": "center"
            }, {
                "sTitle": "密码",
                "sWidth": 80,
                "sClass": "center"
            }, {
                "sTitle": "开始时间",
                "sWidth": 100,
                "sClass": "center"
            },{
                "sTitle": "结束时间",
                "sWidth": 100,
                "sClass": "center"
            }, {
                "sTitle": "操作",
                "sWidth": 80,
                "sClass": "center"
            }];
        var wh = $(window).height();
        var sY = (wh - 278) + 'px';
        var oTable = $(ex).dataTable({
            "bFilter": false,
            "bAutoWidth": true,
            "bProcessing": false,
            "bServerSide": true,
            "sDom": 't<"row"<"col-sm-12"i>>',
            "bSort": false,
            "bScrollCollapse": true,
            "iDisplayLength": 20,
            "iDisplayStart": 0,
            "aoColumns": aoColumns,
            "sAjaxSource": "",
            "bScrollInfinite": true,
            "sScrollY": sY,
            "fnServerData": function (sSource, aDataSet, fnCallback) {
                var startDate = $.trim($('#date-from').val());
                var endDate = $.trim($('#date-to').val());
                var cityName = $.trim($('#city_id').val());
                var name = $.trim($('#name').val());
                var start = 0;
                var length = 0;
                for (var i = 0; i < aDataSet.length; i++) {
                    if (aDataSet[i].name == 'iDisplayStart') {
                        start = aDataSet[i].value;
                    }
                    if (aDataSet[i].name == 'iDisplayLength') {
                        length = aDataSet[i].value;
                    }
                }
                var vars = {};
                vars["start"] = start;
                vars["length"] = length;
                if (startDate != '') {
                    vars["startTime"] = startDate;
                }
                if (endDate != '') {
                    vars["endTime"] = endDate;
                }
                if (cityName != '') {
                    vars["cityName"] = cityName;
                }
                if (name != '') {
                    vars["name"] = name;
                }
                var params = {"vars": vars};
                $.ajax({
                    "contentType": "application/json; charset=utf-8",
                    "type": "POST",
                    "url": url,
                    "data": JSON.stringify(params),
                    "success": function (resp) {
                        if (resp.errorCode == 0) {
                            var data = resp.data;
                            var iTotalRecords = data.count || 0;
                            var iTotalDisplayRecords = iTotalRecords;
                            var aaData = constructTodoTableInfo(data);
                            data = {
                                "aaData": aaData,
                                "iTotalRecords": (iTotalRecords || 0),
                                "iTotalDisplayRecords": (iTotalDisplayRecords || 0)
                            };
                            fnCallback(data);
                        } else {
                            showCommonNoticeDialog('失败', 'icon-warning-sign',
                                    generateNoticeMsg(resp.errorMessage), 300);
                        }
                    },
                    error: function () {
                        showCommonNoticeDialog('网络错误', 'icon-bolt', generateNoticeMsg('网络错误，请刷新后重试!'), 300);
                    }
                });
            },
            "fnDrawCallback": function () {
                if (!oTable) {
                    return;
                }

                $("#search").unbind("click");
                $("#search").on("click", function (e) {
                    showApplyTodoInfo(url, tableName, rTableId, status);
                }).on("dblclick", function (e) {
                    e.preventDefault();
                });

                $("#apply_back").unbind("click");
                $("#apply_back").on("click", function (e) {
                    applyBackorDel(oTable, 1);
                }).on("dblclick", function (e) {
                    e.preventDefault();
                });

                oTable.$('tr.row_selected').removeClass('row_selected');
                oTable.$("tr").unbind('click');
                oTable.$("tr").click({
                    oTable: oTable
                }, function (e) {
                    if ($(this).hasClass('row_selected')) {
                        $(this).removeClass('row_selected');
                    }
                    else {
                        e.data.oTable.$('tr.row_selected').removeClass('row_selected');
                        $(this).addClass('row_selected');
                        var id = e.data.oTable.fnGetData(this)[1];
                        showApplyTodoOrHistoryDetailsList(id, rTableId, status);
                    }
                });
            },
            fnInitComplete: function () {
                $('#current-checkbox-select-all').prop('checked', false);
                $('#current-checkbox-select-all').attr('checked', false);
                toggleCheck(oTable);
            }
        })
    }

</script>